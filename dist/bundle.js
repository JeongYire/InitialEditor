!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e){t.exports=require("electron")},function(t,e){t.exports=require("child_process")},function(t,e,i){"use strict";i.r(e);class s{constructor(){this._events={}}on(t,e){return this._events[t]||(this._events[t]=[]),this._events[t].push(e),this}emit(t,...e){this._events[t]||(this._events[t]=[]),this._events[t].forEach(t=>{"function"==typeof t&&t(...e)})}}class n extends s{constructor(...t){super(),this.initMembers(...t),this.start(...t)}initMembers(...t){this._isActiveEvent=!1}active(){this._isActiveEvent=!0}deactive(){this._isActiveEvent=!1}isActiveEvent(){return this._isActiveEvent}start(...t){return this}update(...t){}}class o extends n{start(){this._isMenuOpen=!1,$(".toolbar").draggable({snap:".menu"}),$(".aside__tabs").resizable({containment:"#aside"});const t=$(".toolbar").get(0).getBoundingClientRect();this._originalPos={x:t.x,y:t.y},this._currentTarget=null}isMenuOpen(){return this._isMenuOpen}hideMenu(){$("#none").prop("checked",!0),this._isMenuOpen=!1}update(t,e){if($(".toolbar").is(".ui-draggable-dragging")){$(".toolbar").get(0).getBoundingClientRect()}let i=t.parentNode;for(;null!=i&&"menu__main"!=i.className;)i=i.parentNode;$("ul[class*='sub']").is(":visible");i&&"menu__main"===i.className?this._isMenuOpen=!0:this._isMenuOpen&&e.buttons.leftFire&&this.hideMenu()}}class a extends n{initMembers(...t){this._config=t[0],this._tileWidth=this._config.TILE_WIDTH,this._tileHeight=this._config.TILE_HEIGHT,this._isReady=!1,this.initWithElement(),this.active()}initWithElement(){const t=$("#view");let e=null;if(e=document.querySelector("#tileset-marker"))return void t.get(0).removeChild(e);this._element=$("<div></div>",{id:"tileset-marker"}).css({"min-width":this._tileWidth+"px","min-height":this._tileHeight+"px",width:this._tileWidth+"px",height:this._tileHeight+"px",position:"absolute",top:"0",left:"0",margin:"0",padding:"0",border:"2px dotted white","z-index":"50","box-sizing":"border-box"}),this._isReady=!0,t.append(this._element),this._isDraw=!1,this._isClicked=!1,this._blockSize=new r(0,0,this._tileWidth,this._tileHeight),this._blockSize.setParent(this._element),this.touches=[{x:0,y:0},{x:0,y:0}];$("#view").offset().top}start(){}update(...t){if(!this._isReady)return;t[0].target;const e=$("#view canvas"),i=Math.floor(e.width()/this._config.TILE_WIDTH),s=e.width(),n=e.height(),o=t[0],a=this._tileWidth,r=this._tileHeight;let h=Math.floor(o.x/a)*a,c=Math.floor(o.y/r)*r;const l=h/a,d=(c-0)/r;h<0&&(h=0),h>s-a&&(h=s-a),c<0&&(c=0),c>n&&(c=n-r+0),this._element.css({position:"absolute",left:h+"px",top:c-0+"px"}),console.log("타일 ID : "+(d*i+l)),window.app.setTileId(d*i+l)}}class r{constructor(t,e,i,s){this._x=t,this._y=e,this._width=i,this._height=s,this._parent=null}set width(t){this._width=t}set height(t){this._height=t}get width(){return this._width}get height(){return this._height}set x(t){this._x=t}set y(t){this._y=t}get x(){return this._x}get y(){return this._y}setParent(t){this._parent=t}refresh(){this._parent.css({width:this.width,height:this.height,left:this._x,top:this._y,position:"absolute"})}}class h extends n{initMembers(...t){this._config=t[0],this._tileset=$("#view canvas").get(0),this._tileWidth=this._config.TILE_WIDTH,this._tileHeight=this._config.TILE_HEIGHT,this._mapCols=this._config.MAP_COLS,this._mapRows=this._config.MAP_ROWS,this._tileId=0,this._mouseX=0,this._mouseY=0,this._currentLayer=0,this._autoTileIndexedList=[],this._autoTileTextureList={},this._tileType=0,this._mapWidth=Math.round(this._config.SCREEN_WIDTH/this._tileWidth),this._mapHeight=Math.round(this._config.SCREEN_HEIGHT/this._tileHeight),this._layerCount=this._config.LAYERS,localStorage.removeItem("tileMapData"),(this._data=localStorage.getItem("tileMapData"))||(this._data=new Array(this._mapWidth*this._mapHeight*this._config.LAYERS));const e=$("#view canvas").get(0);if(!e)throw new Error("Cant't find tileset");this._mapCols=Math.floor(e.width/this._tileWidth),this._mapRows=Math.floor(e.width/this._tileWidth),this.active()}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}initWithDrawingType(){this._penType=0,$("#pen-tool").on("click",()=>{this._penType=0,console.log("펜")}),$("#square-tool").on("click",()=>{this._penType=1,console.log("사각형")})}initWithLayers(){const t=this._config.LAYERS,e=Math.round(this._config.SCREEN_WIDTH/this._tileWidth),i=Math.round(this._config.SCREEN_HEIGHT/this._tileHeight);for(let s=0;s<t;s++)for(let t=0;t<i;t++)for(let i=0;i<e;i++)this.set(i,t,s,0)}setData(t,e,i,s){t<0&&(t=0),t>this._mapWidth-1&&(t=this._mapWidth-1),e=Math.min(Math.max(0,e),this._mapHeight-1),i=Math.min(Math.max(0,i),this._config.LAYERS-1);const n=this._mapWidth*this._mapHeight*i+this._mapWidth*e+t;this._data[n]=s}getData(t,e,i){t<0&&(t=0),t>this._mapWidth-1&&(t=this._mapWidth-1),e=Math.min(Math.max(0,e),this._mapHeight-1),i=Math.min(Math.max(0,i),this._config.LAYERS-1);const s=this._mapWidth*this._mapHeight*i+this._mapWidth*e+t;return this._data[s]||0}setTileId(t){this._tileId=t}getTileId(){return this._tileId}setCurrentLayerId(t){this._currentLayer=t}getCurrentLayerId(){return this._currentLayer}start(){let t={width:this._config.SCREEN_WIDTH,height:this._config.SCREEN_HEIGHT,resolution:window.devicePixelRatio||1,view:$("#contents__main-canvas").get(0),autoDensity:!0,transparent:!1};t.height=$(window).innerHeight()-$(".toolbar").innerHeight()-30,t.width=$(window).innerWidth()-$(".aside__tabs").innerWidth()-10,this._app=new PIXI.Application(t),this._layerContainer=new PIXI.Container,this._layerContainer.interactive=!0,this._layerContainer.on("mousemove",this.onMouseMove.bind(this)),this._layerContainer.on("pointermove",this.onMouseMove.bind(this)),this.app.stage.addChild(this._layerContainer);for(let t=0;t<this._config.LAYERS;t++)this._layerContainer.addChild(new PIXI.Container);this._tilesets=[],this._tilesets.push(PIXI.Texture.from(this._tileset)),this.initWithDrawingType(),$("#take-screenshot").on("click",t=>{this.takeScreenshot(),t.stopPropagation()})}get app(){return this._app}takeScreenshot(){const t=this._app;t&&t.renderer.extract.canvas(t.stage).toBlob(t=>{const e=document.createElement("a");document.body.append(e),e.download="screenshot",e.href=URL.createObjectURL(t),e.onclick=function(t){t.preventDefault(),t.stopPropagation()},e.click(),e.remove()},"image/png")}onMouseMove(t){this._mouseX=t.data.global.x,this._mouseY=t.data.global.y}getTileset(){const t=this._tileset;if(!t)throw new Error("Can't find the tileset from the memory.");if(Array.isArray(t)&&t.length<=0)throw new Error("The tileset image can't create correctly.");return t[0]}cropTexture(t,e,i){const s=new PIXI.Rectangle(t,e,this._tileWidth,this._tileHeight);return new PIXI.Texture(i.baseTexture,s)}collectAutoTileID(t,e){const i=Math.floor(t/this._tileWidth),s=Math.floor(e/this._tileHeight),n=this._currentLayer;let o=0;return[this.getData(i+0,s-1,n)<=0,this.getData(i+1,s-1,n)<=0,this.getData(i+1,s+0,n)<=0,this.getData(i+1,s+1,n)<=0,this.getData(i+0,s+1,n)<=0,this.getData(i-1,s+1,n)<=0,this.getData(i-1,s+0,n)<=0,this.getData(i-1,s-1,n)<=0].forEach((t,e,i)=>{!0===t&&(o+=1<<e)}),o}drawTile(t,e,i){let s=Math.floor(t/this._tileWidth),n=Math.floor(e/this._tileHeight);console.log(t,e,s,n),this.setData(s,n,this._currentLayer,i),this._dirty=!0}drawRect(t,e,i,s){let n=Math.floor(t/this._tileWidth),o=Math.floor(e/this._tileHeight);const a=this._tileId,r=n+i,h=o+s;for(let t=o;t<h;t++)for(let e=n;e<r;e++)this.setData(e,t,this._currentLayer,a);this._dirty=!0}isAutoTile(t){return this._autoTileIndexedList.indexOf(tileId)>=0}update(...t){const e=this._penType,i=this._tileId;switch(e){case 0:this.drawTile(this._mouseX,this._mouseY,i);break;case 1:this.drawRect(this._mouseX,this._mouseY,20,5)}this._dirty&&(this.draw(),this._dirty=!1)}clear(){this._layerContainer.children.forEach(t=>{t.removeChildren()})}getTileCropTexture(t){let e=PIXI.Texture.from(this._tileset);const i=Math.floor(e.width/this._tileWidth),s=(Math.floor(e.height/this._tileHeight),t%i*this._tileWidth),n=Math.floor(t/i)*this._tileHeight;return this.cropTexture(s,n,e)}toggleLayerVisibility(t){if(!this._layerContainer)return;const e=this._layerContainer.children;e[t].visible=!e[t].visible}updateAlphaLayers(){const t=this._currentLayer,e=this._layerContainer.children;e.filter((e,i,s)=>i!==t).forEach(t=>{t.alpha=.25}),e[t].alpha=1}draw(){this.clear();const t=this._mapWidth,e=this._mapHeight;for(let i=0;i<this._config.LAYERS;i++){const s=this._layerContainer.children[i];for(let n=0;n<e;n++)for(let e=0;e<t;e++){const t=this.getData(e,n,i);if(!t)continue;const o=new PIXI.Sprite(this.getTileCropTexture(t));o.x=e*this._tileWidth,o.y=n*this._tileHeight,s.addChild(o)}}}}function c(t){let e=(t||"").split(/[\s\-]/),i=e.slice(1);return e[0].concat(i.map(t=>t[0].toUpperCase()+t.slice(1)))}function l(t){const e=c(t);return e.slice(0,1).toUpperCase()+e.slice(1)}i(0);class d{constructor(t){this.initMembers(t)}initMembers(t){}toJson(){return JSON.stringify(this)}}class _ extends d{initMembers(t){this.ProjectPath="E:\\VS2015\\Projects\\Initial2D",this.TileWidth=16,this.TileHeight=16,this.CurrentLayer=1,this.StartMapId=1,this.CurrentMapId=1}}const u={SCREEN_WIDTH:800,SCREEN_HEIGHT:600,TILE_WIDTH:16,TILE_HEIGHT:16,MAP_COLS:32,MAP_ROWS:8,LAYERS:4,TRANSPARENT_COLOR_GROUP:["#007575"],TILESET_IMGAGES:["./images/tiles/tileset16-8x13.png","./images/tiles/2k_town05.png","./images/tiles/2k_town05-01.png"],Editor:new _,Maps:new _};class m{constructor(...t){this.initMembers(...t)}initMembers(...t){this._config=t[0],this._isReady=!1,this._tilesetImgages=this._config.TILESET_IMGAGES}async start(){return this.loadTilesets()}async loadTilesets(){this._tilesets=[];let t=0;return new Promise((e,i)=>{for(let s=0;s<this._tilesetImgages.length;s++){const n=$("<img>").attr("src",this._tilesetImgages[s]);n.on("load",()=>{this._tilesets.push(n),++t,t>=this._tilesetImgages.length&&(console.log(this._tilesetImgages[s]),this.createCanvas(),e())}),n.on("error",i)}})}async refreshTilesets(t){this._tilesetImgages.push(t),this._canvas&&this._canvas.remove(),await this.start().then(t=>{window.app.createComponents()})}createCanvas(){const t=this._config.TILE_WIDTH*this._config.MAP_COLS,e=this._config.TILE_HEIGHT*this._config.MAP_ROWS*4;this._parent=$("#view"),this._canvas=$("<canvas />",{id:"tileset-canvas"}).attr("width",t).attr("height",e).css({padding:"0",margin:"0"}),this._parent.prepend(this._canvas),this._parent.css({width:"100%",height:"60%"}),this._context=this._canvas.get(0).getContext("2d");const i=this._context;let s=0,n=0;for(let t=0;t<this._tilesetImgages.length;t++){const e=this._tilesets[t],o=e.get(0).naturalWidth,a=e.get(0).naturalHeight;a>s+a&&(n=s+a,this._canvas.prop("height",n)),i.setTransform(1,0,0,1,0,s),i.imageSmoothingEnabled=!1,i.drawImage(e.get(0),0,0,o,a),s+=a}this._isReady=!0}}class p extends a{initWithElement(){const t=$(".contents");let e=null;(e=document.querySelector("#tile-marker"))?t.get(0).removeChild(e):(this._element=$("<div></div>",{id:"tile-marker"}).css({"min-width":this._tileWidth+"px","min-height":this._tileHeight+"px",width:this._tileWidth+"px",height:this._tileHeight+"px",position:"absolute",top:"0",left:"0",margin:"0",padding:"0",border:"2px dotted white","z-index":"0","box-sizing":"border-box"}),this._isReady=!0,t.append(this._element))}update(...t){if(!this._isReady)return;t[0].target;const e=$("#contents__main-canvas"),i=(Math.floor(e.width()/this._config.TILE_WIDTH),e.width()),s=e.height(),n=t[0],o=this._tileWidth,a=this._tileHeight;let r=Math.floor(n.x/o)*o,h=Math.floor(n.y/a)*a;r<0&&(r=0),r>i-o&&(r=i-o),h<0&&(h=0),h>s&&(h=s-a+0),this._element.css({position:"absolute",left:r+"px",top:h-0+"px"})}}class g{constructor(){this._data=this.getData()}getData(){return{}}get data(){return this._data}}class f extends g{getData(){return{width:"240px",height:"100%",parentId:".windows-container",id:"newContainer",zIndex:"10",path:"view/windows/newWindow.html",position:"absolute",display:"flex"}}}class w{constructor(t){this.initMembers(t.data),this.initWithCanvas()}initMembers(t){this._config=t,this._isValid=!1,this._uniqueId=null}setUniqueId(t){this._uniqueId=t}initWithCanvas(){const t=this._config;if(!t.parentId||!t.id)throw new Error("The parent element is not exist!");this._element=$("<div></div>").css(t).attr("id",t.id).draggable({snap:".container"}),this.hide(),$("#"+t.id).resizable({containment:t.parentId}),$(t.parentId).append(this._element)}isMobile(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/i)}hide(){$(this._config.parentId).hide(),this._element.hide(),this._isValid=!1}show(){this._element.show(),$(this._config.parentId).show(),this._isValid=!0,$(".darken, .windows-container").css("left","0")}remove(){this._element.fadeOut(700,()=>{this._element.remove()}),$(".darken, .windows-container").css("left","-9999px"),delete k.GetInstance().cache[this._uniqueId]}isMobile(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/i)}load(){return new Promise((t,e)=>{const i=new XMLHttpRequest,s=this._config.path,n=`${location.href.slice(0,location.href.lastIndexOf("/"))}/${s}`;i.open("GET",n),i.onload=function(){200===i.status&&t(i.responseText)},i.onerror=e,i.send()})}async render(){await this.load().then(t=>{this._element.html(t)}).catch(t=>{console.warn(t)})}onLoad(t,e){this.addEventHandlers(t,e)}addEventHandlers(){}}class y extends w{constructor(t){super(t)}onLoad(t,e){super.onLoad(t,e);t.parentNode.querySelector(".newWindow__control-box p i").onclick=()=>{e.remove()},this.show(),$(".darken, .windows-container").css("left","0")}onClick(t){this.show(),$("#none").prop("checked",!0)}onOkButton(t){const e=$("#newContainer #newWindow").find("input"),i={gameName:$(e[0]).val(),gameFolder:$(e[1]).val(),author:$(e[2]).val()};alert(JSON.stringify(i,null,"\t")),this.remove()}addEventHandlers(t,e){$("#newContainer #newWindow").find("div.panel").eq(0).on("click",t=>{this.onOkButton(t)})}}class b extends g{getData(){return{width:"540px",height:"100%",parentId:".windows-container",id:"tileset-container",zIndex:"10",path:"view/windows/tilesetWindow.html",opacity:"1.0"}}}class v{constructor(t,e,i,s){this._x=t,this._y=e,this._width=i,this._height=s}get x(){return this._x}get y(){return this._x}get width(){return this._width}get height(){return this._height}set x(t){this._x=t}set y(t){this._x=t}set width(t){this._width=t}set height(t){this._height=t}contains(t,e){const i=this._x,s=this._y,n=this._width,o=this._height;return t>=i&&t<=i+n&&e>=s&&e<=s+o}}v.EMPTY=new v(0,0,0,0);const x={name:"toolbar__empty-line--modifier",children:"empty-line",action:t=>{}},I=[].concat([{name:"파일 만들기",children:"file-new",action:t=>{C.GrapWindow(t)}},{name:"파일 열기",children:"file-open",action:t=>{C.GrapWindow(t)}},{name:"파일 저장",children:"file-save",action:t=>{C.GrapWindow(t)}},{name:"파일 저장",children:"edit-undo",action:t=>{C.GrapWindow(t)}},x],[{name:"",children:"edit-cut",action:t=>{}},{name:"",children:"edit-copy",action:t=>{}},{name:"",children:"edit-paste",action:t=>{}},{name:"",children:"edit-delete",action:t=>{}},x],[{name:"",children:"mode-map",action:t=>{}},{name:"",children:"mode-event",action:t=>{}},{name:"",children:"mode-region",action:t=>{}},x],[{name:"",children:"draw-pencil",action:t=>{}},{name:"",children:"draw-rectangle",action:t=>{}},{name:"",children:"draw-ellipse",action:t=>{}},{name:"",children:"draw-flood-fill",action:t=>{}},{name:"",children:"draw-shadow-pen",action:t=>{}},x],[{name:"",children:"take-screenshot",action:t=>{}},{name:"",children:"tools-resource-manager",action:t=>{}},{name:"",children:"tools-script-eidtor",action:t=>{}},{name:"",children:"tools-sound-test",action:t=>{}},x,{name:"",children:"tools-options",action:t=>{}},x,{name:"",children:"game-playtest",action:t=>{}},x,{name:"",children:"game-folder-open",action:t=>{}}]);window.ToolbarManager=new class{constructor(){this.initMembers(),this.create()}initMembers(){this._mainToolbarId=".toolbar",this._isOpened=!1,this._isMovable=!1,this.lock(),this._originPosition=$(this._mainToolbarId).get(0).getBoundingClientRect()}show(){this._isOpened=!0,$(this._mainToolbarId).show()}hide(){this._isOpened=!1,$(this._mainToolbarId).hide()}lock(){$(this._mainToolbarId).draggable({disabled:!0})}unlock(){const{x:t,y:e}=this._originPosition;$(this._mainToolbarId).css({left:t,top:e}),$(this._mainToolbarId).draggable({disabled:!1})}create(){$("li",this._mainToolbarId).each((t,e)=>{console.log(e,I[t])});I.slice(0).forEach((t,e,i)=>{const s=$(`li[data-action='${t.children}']:last`);s.get()[0]&&s.on("click",e=>{"function"==typeof t.action&&t.action.call(this,e)})})}};class M extends s{initMembers(){this.cache={},this._config=u,this._mouse={x:0,y:0,screenX:0,screenY:0,buttons:{left:!1,leftFire:!1},target:null,menuTarget:null},this._blockRect={isDrawing:!1,rect:new v(0,0,1,1)},this._now=performance.now(),this._isMenuOpen=!1,this._tileId=0,this._isReady=!1,document.title="Initial Map Editor",this.emit("ready",JSON.stringify(this))}createComponents(){this._components.push(this._tilesetMarker=new a(this._config)),this._components.push(this._tilemap=new h(this._config)),this._components.push(this._tileMarker=new p(this._config)),this._components.forEach(t=>{t.start()}),this._tilemap.setTileId(0)}async initWithComponents(){this._components=[],this._components.push(this._menu=new o(this._config)),this._components.push(this._menuController=new E(this._config,this._menu)),this._tilesetCanvas=new m(this._config),await this._tilesetCanvas.start().then(t=>{this.createComponents()}).then(t=>{$(".darken, .windows-container").css("left","-9999px")}).catch(t=>{console.warn(t)})}toCamelCase(){return c()}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}onMouseTouchMove(t){this._mouse.x=t.layerX,this._mouse.y=t.layerY,this._mouse.screenX=t.layerX,this._mouse.screenY=t.layerY}initWithMouseEvent(){let t;if(this.isMobileDevice())t={touchmove:t=>{let e=t;t.type.indexOf("touch")>=0&&(e=t.touches[0]);this._mouse.target;const i=this._mouse.target.getBoundingClientRect();this._mouse.x=e.clientX-i.x,this._mouse.y=e.clientY-i.y,this._mouse.screenX=e.screenX,this._mouse.screenY=e.screenY},"touchstart pointerdown":t=>{let e=t;t.type.indexOf("touch")>=0&&(e=t.touches[0]),this._mouse.target=t.target;this._mouse.target;const i=this._mouse.target.getBoundingClientRect();this._mouse.x=e.clientX-i.x,this._mouse.y=e.clientY-i.y,this._mouse.screenX=e.screenX,this._mouse.screenY=e.screenY,this._mouse.buttons.left=!0,this._mouse.buttons.leftFire=!1},"touchend pointerup mouseup":t=>{this._mouse.buttons.left=!1,this._mouse.buttons.leftFire=!0}},$(window).on(t);else{t={mousemove:t=>{this._mouse.x=t.layerX,this._mouse.y=t.layerY,this._mouse.screenX=t.layerX,this._mouse.screenY=t.layerY},mousedown:t=>{0==t.button&&(this._mouse.buttons.left=!0,this._mouse.buttons.leftFire=!1,this._mouse.target=t.target)},mouseup:t=>{0==t.button&&(this._mouse.buttons.left=!1,this._mouse.buttons.leftFire=!0,this._blockRect.isDrawing=!1)},mouseover:t=>{this._menu._isMenuOpen&&(this._mouse.buttons.menuTarget=t.target,this._menu.emit("menu_open",this._mouse.buttons.menuTarget))}};for(let e in t)window.addEventListener(e,t[e],!1)}}setTileId(t){this._tilemap&&this._tilemap.setTileId(t)}initWithMapLayers(){$("ul.aside__tabs__maptree-child-tree li i").children().each((t,e)=>{const i=i.get(0);e.click(()=>{i.className=i.className.includes("slash")?"far fa-eye":"far fa-eye-slash"})}),$("ul.aside__tabs__maptree-child-tree li i").on("click",t=>{const e=$(t.currentTarget),i=$(t.currentTarget).parent().index(),s=this._tilemap;e.hasClass("fa-eye")?e.removeClass("fa-eye").addClass("fa-eye-slash"):e.removeClass("fa-eye-slash").addClass("fa-eye"),s.toggleLayerVisibility(i)}),$("ul.aside__tabs__maptree-child-tree li").on("click",t=>{const e=$(t.currentTarget).css({backgroundColor:"var(--dark-selection-color)"});$("ul.aside__tabs__maptree-child-tree li").not(e).css({backgroundColor:"rgba(255, 255, 255, 0)"});const i=e.index(),s=this._tilemap;s.setCurrentLayerId(i),s.clear(),s.draw(),s.updateAlphaLayers()}),$("ul.aside__tabs__maptree-child-tree li:first-child").trigger("click")}start(){this.initMembers(),this.initWithMouseEvent(),this.initWithComponents().then(t=>{this.initWithMapLayers(),this._isReady=!0,this.on("update",t=>{this.update(t)})}).catch(t=>{console.warn(t),this._isReady=!1})}update(t){this._isReady&&(t-this._now>=400&&(this._now=t),this.updateComponents(),this._mouse.buttons.leftFire=!1)}updateComponents(){const t=this._mouse.target;if(!t)return;const e=t.id,i=this._mouse;if(this._menu.update(t,i),!this._menu.isMenuOpen())switch(e){case"tileset-canvas":case"view":this._mouse.buttons.leftFire&&this._tilesetMarker.update(i);break;case"contents__main-canvas":this._mouse.buttons.left&&this._tilemap.update(i),this._mouse.buttons.leftFire&&this._tileMarker.update(i)}}onLoad(t,e){C.onLoad(t,e)}static GetInstance(){return M.Instance||(M.Instance=new M),M.Instance}}M.Instance=null;class T extends w{constructor(t){super(t)}onLoad(t,e){super.onLoad(t,e);t.parentNode.querySelector(".tilesetWindow__control-box p i").onclick=()=>{e.remove()},$(t.parentNode).find(".tilesetWindow__panel #ok").on("click",t=>{this.onOk(t)}),$(t.parentNode).find(".tilesetWindow__panel #cancel").on("click",t=>{this.onCancel(t)}),$("input#image-load-dialog").on("change",t=>{const e=Array.from(t.target.files);console.log(e[0].name,e[0].path)}),this.show()}onOk(t){this.remove();const e=this._element.find("input");$(e[0]).val(),$(e[1]).val(),parseInt($(e[2]).val()),parseInt($(e[3]).val());$('form[name="uploadTilesetImage"]').on("submit",(function(t){t.preventDefault(),$.ajax({type:"POST",cache:!1,contentType:!1,processData:!1,url:$(this).attr("action"),data:new FormData(this),success:function(t){console.log(t)},error:function(t){console.log("error"),console.log(t)}})}))}onCancel(t){t.preventDefault(),this.remove()}}class C extends s{constructor(){super(),this._app=k.GetInstance(),this.cache={}}onFileNew(){this._gamePropertiesWindow=new y(new f),this._gamePropertiesWindow.render().then(t=>{const e="new-window";this.cache[e]=this._gamePropertiesWindow,this._gamePropertiesWindow.setUniqueId(e)}).catch(t=>{console.warn(t)})}onToolsOptions(){this._tilesetWindow=new T(new b),this._tilesetWindow.render().then(t=>{const e="tileset";this.cache[e]=this._tilesetWindow,this._tilesetWindow.setUniqueId(e)}).catch(t=>{console.warn(t)})}update(){for(let t in this.cache)this.cache[t]instanceof w&&this.cache[t].remove()}static GrapWindow(t){const e=$(t.currentTarget);if(!e)return;const i=e.data("action"),s=C.GetInstance(),n=s["on"+l(i)].bind(s);"function"==typeof n&&n()}static GrapWindowAsType(t){const e=C.GetInstance(),i=e["on"+l(t)].bind(e);"function"==typeof i&&i()}static onLoad(t,e){const i=this.GetInstance();if(i.cache[e]){const s=i.cache[e];i.cache[e].onLoad(t,s)}}static GetInstance(){return C.Instance||(C.Instance=new C),C.Instance}}C.Instance=null;const W={ko:{file:{name:"파일",children:{"file-new":{name:"새로 만들기",children:{},shortcut:["ctrl","n"],action:function(t){C.GrapWindow(t)}},"file-open":{name:"파일 열기",shortcut:["ctrl","o"],children:{}},"file-close":{name:"파일 닫기",children:{}},"file-save":{name:"파일 저장",children:{}},"file-preferences":{name:"환경 설정",children:{}},"file-export":{name:"내보내기",children:{}},"file-exit":{name:"프로그램 종료",children:{}}}},edit:{name:"편집",children:{"edit-undo":{name:"취소",children:{}},"edit-cut":{name:"자르기",children:{}},"edit-copy":{name:"복사하기",children:{}},"edit-paste":{name:"붙여넣기",children:{}},"edit-delete":{name:"삭제하기",children:{}}}},mode:{name:"모드",children:{"mode-map":{name:"맵",children:{}},"mode-event":{name:"이벤트",children:{}},"mode-region":{name:"지역",children:{}}}},draw:{name:"그리기",children:{"draw-pencil":{name:"펜",children:{},action:t=>{}},"draw-rectangle":{name:"정사각형",children:{},action:t=>{}},"draw-ellipse":{name:"직사각형",children:{},action:t=>{}},"draw-flood-fill":{name:"채우기",children:{},action:t=>{}},"draw-shadow pen":{name:"그림자",children:{},action:t=>{}}}},scale:{name:"배율",children:{"scale-1x":{name:"실제 비율",children:{},action:t=>{}},"scale-2x":{name:"2배 축소",children:{},action:t=>{}},"scale-4x":{name:"4배 축소",children:{},action:t=>{}},"scale-8x":{name:"8배 축소",children:{},action:t=>{}}}},tools:{name:"도구",children:{"tools-database":{name:"데이터베이스",children:{},action:t=>{}},"tools-resource-manager":{name:"소재 관리자",children:{},action:t=>{}},"tools-script-eidtor":{name:"스크립트 에디터",children:{},action:t=>{}},"tools-sound-test":{name:"사운드 테스트",children:{}},"tools-options":{name:"옵션",children:{},action:function(t){C.GrapWindow(t)}}}},game:{name:"게임",children:{"game-playtest":{name:"플레이 테스트",children:{},action:t=>{alert("플레이 테스트 기능을 지원하지 않습니다.")}},"game-fullscreen":{name:"전체 화면",children:{},action:t=>{}},"game-show-console":{name:"콘솔 표시",children:{},action:t=>{}},"game-folder-open":{name:"게임 폴더 열기",children:{},action:t=>{if("electron"===platform){const t=i(1),e=process.cwd();t.execSync("start "+e,{encoding:"utf8"})}}}}},help:{name:"도움말",children:{"help-contents":{name:"도움말",children:{},action:t=>{alert("도움말이 아직 없습니다.")}},"help-about":{name:"버전 정보",children:{},action:t=>{}}}},$font:{size:"8pt"}}};class E extends n{initMembers(...t){this._menuComponent=t[1],this._isClickedMenu=!1}start(...t){this.changeMenuLocaleAsPersonalize(),this.changeToolbarIconOnMobileDevice(),this.addMenuEventHandlers()}changeMenuLocaleAsPersonalize(){const t=navigator.language.slice(0,2);$(".menu__main label").each((e,i)=>{const s=$(i),n=s.data("action"),o=W[t];if(o){const t=o[n],e=t.name,i=o.$font;s.text(e),s.css("font-size",i.size),$(`.menu__${n}-sub li`).each((e,n)=>{const o=$(n),a=s.parent();o.parent().css("left",a.get(0).getBoundingClientRect().x+"px");const r=o.data("action"),h=t.children[r];if(h){h.action&&(o.get(0).onclick=h.action);const t=h.name;o.get(0).childNodes.forEach(e=>{3==e.nodeType&&(e.textContent=t)}),o.css("font-size",i.size)}})}})}addMenuEventHandlers(){$(".menu .control-box li.minimum").on("click",t=>{if("electron"===platform){const{ipcRenderer:e}=i(0);e.send("minimize"),t.stopImmediatePropagation()}}),$(".menu .control-box li.maximum").on("click",t=>{if("electron"===platform){const{ipcRenderer:e}=i(0);e.send("maximize"),t.stopImmediatePropagation()}}),$(".menu .control-box li.close").on("click",t=>{window.close(),t.stopImmediatePropagation()})}changeToolbarIconOnMobileDevice(){window.matchMedia("(max-width: 640px)").matches&&$(".toolbar i").each((t,e)=>{$(e).addClass("fa-3x").css({width:"98%",height:"98%","font-size":"1.25em"})});const t={".contents":{width:"65%"},".aside__tabs":{width:"30%"},"#contents__main-canvas":{width:"100%"}};$(window).on("resize",()=>{if($(window).width()<=640){for(let e in t)$(e).css(t[e]);$(".toolbar i").each((t,e)=>{$(e).removeClass("fa-3x").addClass("fa-3x").css({width:"98%",height:"98%","font-size":"1.25em"})})}else $(".toolbar i").each((t,e)=>{$(e).removeClass("fa-3x").addClass("fa-sm").css({width:"98%",height:"98%","font-size":"0.875em"})})})}}class k extends s{initMembers(){this.cache={},this._config=u,this._mouse={x:0,y:0,screenX:0,screenY:0,buttons:{left:!1,leftFire:!1},target:null,menuTarget:null},this._blockRect={isDrawing:!1,rect:new v(0,0,1,1)},this._now=performance.now(),this._isMenuOpen=!1,this._tileId=0,this._isReady=!1,document.title="Initial Map Editor",this.emit("ready",JSON.stringify(this))}createComponents(){this._components.push(this._tilesetMarker=new a(this._config)),this._components.push(this._tilemap=new h(this._config)),this._components.push(this._tileMarker=new p(this._config)),this._components.forEach(t=>{t.start()}),this._tilemap.setTileId(0)}async initWithComponents(){this._components=[],this._components.push(this._menu=new o(this._config)),this._components.push(this._menuController=new E(this._config,this._menu)),this._tilesetCanvas=new m(this._config),await this._tilesetCanvas.start().then(t=>{this.createComponents()}).then(t=>{$(".darken, .windows-container").css("left","-9999px")}).catch(t=>{console.warn(t)})}toCamelCase(){return c()}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}onMouseTouchMove(t){this._mouse.x=t.layerX,this._mouse.y=t.layerY,this._mouse.screenX=t.layerX,this._mouse.screenY=t.layerY}initWithMouseEvent(){let t;if(this.isMobileDevice())t={touchmove:t=>{let e=t;t.type.indexOf("touch")>=0&&(e=t.touches[0]);this._mouse.target;const i=this._mouse.target.getBoundingClientRect();this._mouse.x=e.clientX-i.x,this._mouse.y=e.clientY-i.y,this._mouse.screenX=e.screenX,this._mouse.screenY=e.screenY},"touchstart pointerdown":t=>{let e=t;t.type.indexOf("touch")>=0&&(e=t.touches[0]),this._mouse.target=t.target;this._mouse.target;const i=this._mouse.target.getBoundingClientRect();this._mouse.x=e.clientX-i.x,this._mouse.y=e.clientY-i.y,this._mouse.screenX=e.screenX,this._mouse.screenY=e.screenY,this._mouse.buttons.left=!0,this._mouse.buttons.leftFire=!1},"touchend pointerup mouseup":t=>{this._mouse.buttons.left=!1,this._mouse.buttons.leftFire=!0}},$(window).on(t);else{t={mousemove:t=>{this._mouse.x=t.layerX,this._mouse.y=t.layerY,this._mouse.screenX=t.layerX,this._mouse.screenY=t.layerY},mousedown:t=>{0==t.button&&(this._mouse.buttons.left=!0,this._mouse.buttons.leftFire=!1,this._mouse.target=t.target)},mouseup:t=>{0==t.button&&(this._mouse.buttons.left=!1,this._mouse.buttons.leftFire=!0,this._blockRect.isDrawing=!1)},mouseover:t=>{this._menu._isMenuOpen&&(this._mouse.buttons.menuTarget=t.target,this._menu.emit("menu_open",this._mouse.buttons.menuTarget))}};for(let e in t)window.addEventListener(e,t[e],!1)}}setTileId(t){this._tilemap&&this._tilemap.setTileId(t)}initWithMapLayers(){$("ul.aside__tabs__maptree-child-tree li i").children().each((t,e)=>{const i=i.get(0);e.click(()=>{i.className=i.className.includes("slash")?"far fa-eye":"far fa-eye-slash"})}),$("ul.aside__tabs__maptree-child-tree li i").on("click",t=>{const e=$(t.currentTarget),i=$(t.currentTarget).parent().index(),s=this._tilemap;e.hasClass("fa-eye")?e.removeClass("fa-eye").addClass("fa-eye-slash"):e.removeClass("fa-eye-slash").addClass("fa-eye"),s.toggleLayerVisibility(i)}),$("ul.aside__tabs__maptree-child-tree li").on("click",t=>{const e=$(t.currentTarget).css({backgroundColor:"var(--dark-selection-color)"});$("ul.aside__tabs__maptree-child-tree li").not(e).css({backgroundColor:"rgba(255, 255, 255, 0)"});const i=e.index(),s=this._tilemap;s.setCurrentLayerId(i),s.clear(),s.draw(),s.updateAlphaLayers()}),$("ul.aside__tabs__maptree-child-tree li:first-child").trigger("click")}start(){this.initMembers(),this.initWithMouseEvent(),this.initWithComponents().then(t=>{this.initWithMapLayers(),this._isReady=!0,this.on("update",t=>{this.update(t)})}).catch(t=>{console.warn(t),this._isReady=!1})}update(t){this._isReady&&(t-this._now>=400&&(this._now=t),this.updateComponents(),this._mouse.buttons.leftFire=!1)}updateComponents(){const t=this._mouse.target;if(!t)return;const e=t.id,i=this._mouse;if(this._menu.update(t,i),!this._menu.isMenuOpen())switch(e){case"tileset-canvas":case"view":this._mouse.buttons.leftFire&&this._tilesetMarker.update(i);break;case"contents__main-canvas":this._mouse.buttons.left&&this._tilemap.update(i),this._mouse.buttons.leftFire&&this._tileMarker.update(i)}}onLoad(t,e){C.onLoad(t,e)}static GetInstance(){return k.Instance||(k.Instance=new k),k.Instance}}k.Instance=null;class L{static start(){$(async()=>{window.app=k.GetInstance(),window.app.start(),this.update()})}static update(t){window.app.emit("update",t),window.requestAnimationFrame(L.update)}}L.start()}]);
//# sourceMappingURL=bundle.js.map